---
title: 프로젝트 CORS 이슈 해결하기
date: '2024-10-07'
tags: ['React', 'Project']
draft: false
summary: 기업 연계 프로젝트를 하며 발생한 CORS 이슈 해결
---

프로젝트 2주차가 되니 기업에서 전달해주시기로 한 API를 받았다.
에러 없이 한번에 통신이 잘 되었으면 얼마나 좋았을까. 하지만 이번에도 API 통신 시 CORS 에러가 있었다.
지난번에 naver search api를 사용했을 때에는 서버를 내가 수정할 수 없으니 프론트엔드 측에서 proxy서버를 띄워서
요청을 보내는 방법으로 수정했지만 이번에는 백엔드 멘토님이 계셔서 멘토님께 문제점을 말씀드리고 해결 방법을 같이 물색해 나갈 수 있었다.

## CORS란?

우선 CORS가 무엇인지 왜 문제가 발생하는지 알아보자.
CORS는 Cross-Origin Resource Sharing의 약자로 서로 다른 출처(오리진) 간 자원을 공유할 수 있게 해주는 보안 메커니즘이다.
오리진은 도메인(naver.com), 프로토콜(http/https), 포트(3000, 8080, ...)를 포함한 개념으로 이 중 하나라도 다르면 다른 오리진으로 간주된다.
CORS는 서버가 응답에 `Access-Control-Allow-Origin`이라는 헤더를 추가하면 브라우저에 어떤 오리진에서 요청을 허용할 지 지정할 수 있다.

### CORS문제는 왜 발생하나?

브라우저는 기본적으로 SOP(Same-Origin Policy, 동일 출처 정책)을 따르고 있어 같은 오리진에서만 자원에 접근할 수 있는데,
웹 어플리케이션에서는 다른 서버에 있는 API에 데이터를 요청하는 등의 다른 출처의 리소스에 접근할 필요가 있다.
이 때 CORS 문제가 발생하게 된다.

- 다른 오리진간의 요청 즉, 프로토콜, 도메인, 포트 중 하나라도 다르면 다른 오리진이라 SOP에 의해 차단된다.
- 서버에서 요청한 오리진을 허용하는 `Access-Control-Allow-Origin`가 없을 경우 요청이 차단된다.
- 브라우저가 사전 요청을 보낼 때 서버가 이에 올바르게 응답하지 않을 경우 CORS 에러가 발생한다.

서버 간 요청에서는 브라우저처럼 보안 제한이 적용되지 않기 때문에 CORS 문제가 발생하지 않고 주로 브라우저에서 자원을 요청할 때 발생한다.

### CORS 해결방법

1. 서버에서 CORS 허용하기

   `Access-Control-Allow-Origin`을 포함해 특정 오리진에서 오는 요청을 허용할 수 있다.

2. 프론트엔드에서 Proxy 서버 사용하기

   서버를 수정할 수 없다면 프론트 자체에서 proxy 서버를 띄워서 대신 요청을 보내게 하는 방법이 있다.
   이 때 proxy서버는 프론트랑 오리진이 같아야한다.
   이러면 프론트와 proxy서버 간에는 오리진이 같기 때문에 cors 문제가 발생하지 않고
   proxy서버와 백엔드서버 간에는 서버 to 서버 요청이기 때문에 cors문제가 발생하지 않는다.

   ```
   // vite.config.ts
   export default defineConfig({
    plugins: [react()],
    server: {
      proxy: {
        '/v1/search/local': {
        target: 'https://openapi.naver.com',
        changeOrigin: true,
      },
    },
   }});
   ```

## 프로젝트에서 발견한 CORS 문제

### 어떤 문제들이 있었을까?

- `mixed-content` : 오리진의 프로토콜 부분이 달라 발생한 문제

  로컬에서는 정상적으로 API가 불러와졌는데 배포버전에서는 API가 정상적으로 불러와지지 않았다.
  이 부분을 그래서 멘토님께 여쭤보니 내가 보내는 요청은 `http`였고 서버에서는 `https`를 사용해서 발생하는 문제였다.
  URL을 https로 변경한 뒤 확인해보라고 하셔서 우선 https URL의 API를 POSTMAN으로 정상적인지 확인해보았다.

  ![mixedcontent](https://github.com/user-attachments/assets/87cbbe6d-1b94-40da-8f11-de1d0f8938ea)

- `SSL Verification` : Postman이 HTTPS 서버에 요청을 보낼 때 서버의 SSL/TLS 인증서를 검증하는 기능

  처음에는 단순히 요청이 안되어서 '어? API에 문제가 있나?' 했는데 검색해보니 신뢰할 수 있는 인증서를 사용하는지
  검증하는 기능이었다. 따라서 `Disable SSL Verification`버튼을 눌러 해당 기능을 사용하지 않으니 API 응답이 정상적으로 왔다.

  ![ssl](https://github.com/user-attachments/assets/8a3b3540-9980-44e8-bbfb-4dcae0aa6f1e)

- 포트 번호 이슈

  POSTMAN에서까지 API가 정상적으로 요청/응답되는 것을 확인하고 로컬에서 다시 확인하려고 하니 다시 문제가 발생했다.
  분명 멘토님의 로컬에서도 정상으로 작동한다고 하시고 POSTMAN에서도 API가 정상적으로 응답이 받아지는것까지 확인했는데,
  내 로컬에서만 계속 오류가 발생했던 것.
  CORS 문제는 "서로 다른 오리진"이기에 문제가 발생하는데 http/https 프로토콜도 맞췄고 도메인도 문제 없고 그렇다면 남은 것은 포트번호 뿐.
  우리 프로젝트는 VITE에서 제공하는 기본 포트번호인 5173번을 사용했는데
  보통 일반적으로 사용하는 로컬 포트번호는 3000번이나 8080번. 따라서 VITE에서 기본 포트번호를 3000번으로 바꾸고
  로컬에서 API통신을 진행하니 유레카! 드디어 CORS 문제 없이 API 통신이 정상적으로 동작하는 것을 확인할 수 있었다.

- 캐시 문제

  근데 또하나 문제가 있다면 내가 사용하는 API는 총 2종이었는데 하나는 정상적으로 되는데 다른 하나는 또 안되는 것.
  진짜 의문투성이.. 이 부분은 다른 개발자 친구에게 도움을 받았다.
  바로 시크릿 모드에서 통신이 원활하게 되는 것을 확인하는 것. 놀랍게도 시크릿 모드에서는 통신이 원활하게 되었다.
  따라서 브라우저 캐시 삭제를 통해 위의 문제를 해결하고 내가 사용하는 API 모두 정상적으로 작동하는 것을 확인할 수 있었다.
  워낙 계속 이리 테스트해보고 저리 테스트해보고 해서 캐시에 문제가 발생했었나보다.

### 앞으로 CORS 문제가 있을 경우 해결할 방법

앞으로 API 사용 시 CORS 에러를 마주했을 경우 다음과 같은 방법으로 문제 해결을 시도해보자.

1. POSTMAN 등에서 API 정상 작동 확인하기
2. 프로토콜(http/https), 도메인, 포트번호(3000, 8080, 5173 등...) 확인하기
3. 브라우저 시크릿 모드 및 캐시 삭제 활용하기

## 느낀점

기존에 개인 프로젝트를 하면서 항상 <b>localhost 환경</b>에서만 있어서 경험해보지 못했던 다양한 CORS 이슈들을
마주할 수 있는 기회가 되서 좋은 경험이었다. 또한 스스로 왜 문제가 발생했는지 원인 분석을 하면서 문제를 하나 하나
해결해 나가니 뿌듯했었다. 이번 기회를 통해 다음에 비슷한 CORS 문제가 발생해도 두려움 없이 해결할 수 있을 듯 하다.

연휴 시작할 때 멘토님께 이런 저런 문제가 있었다고 말씀드리는게 너무나도 죄송했는데,
너무 감사하게도 답변도 잘 해주시고 격려의 말까지 해주셔서 많이 힘이 되었다. 많은 사람들이 응원해 주시는 만큼
나도 더 좋은 개발자가 되도록 노력해야겠다!!!

![힘내자](https://github.com/user-attachments/assets/3240083e-0d0c-4a71-a4ad-816cc9cffafd)
